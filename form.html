<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Beauty Expert</title>
<style>
  :root {
    --accent: #E75480;         /* —Ä–æ–∑–æ–≤—ã–π Mary Kay */
    --accent-dark: #c7436a;    /* –±–æ–ª–µ–µ —Ç—ë–º–Ω—ã–π —Ä–æ–∑–æ–≤—ã–π –¥–ª—è hover */
    --bg: #FFF5F7;
    --input-bg: #fff;
    --text: #333;
  }
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: var(--bg);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }
  .form-box {
    background: #fff;
    border-radius: 12px;
    padding: 30px 40px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 420px;
  }
  h2 {
    text-align: center;
    color: var(--accent);
    margin-bottom: 20px;
  }
  .lang-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
  }
  .lang-buttons button {
    flex: 1;
    padding: 6px;
    border-radius: 6px;
    border: 1px solid var(--accent);
    background: white;
    cursor: pointer;
    font-weight: bold;
    color: var(--accent);
    transition: all 0.2s;
  }
  .lang-buttons button.active {
    background: var(--accent);
    color: white;
  }
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text);
  }
  input, select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 15px;
    background: var(--input-bg);
    margin-bottom: 12px;
    box-sizing: border-box;
  }
  input:focus, select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 4px rgba(231, 84, 128, 0.3);
  }
  .phone-wrapper {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
  }
  .flag {
    width: 40px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #ccc;
    border-radius: 8px 0 0 8px;
    background: #fff;
    cursor: pointer;
    font-size: 18px;
  }
  .phone-input {
    flex: 1;
    border-radius: 0 8px 8px 0;
    border-left: none;
  }
  button {
    width: 100%;
    padding: 12px 0;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
  }
  button:hover { background: var(--accent-dark); }
  .msg { margin-top: 10px; text-align: center; font-weight: bold; }
  .msg.success { color: green; }
  .msg.error { color: darkred; }
  .checkbox-row {
    display: flex;
    align-items: center;
    margin-top: 8px;
    margin-bottom: 10px;
    font-size: 14px;
  }
  .checkbox-row input {
    margin-right: 8px;
  }
  /* –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω */
  .country-list {
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    max-height: 150px;
    overflow-y: auto;
    display: none;
    z-index: 10;
    border-radius: 6px;
    margin-top: -5px;
    width: 92%;
  }
  .country-list div {
    padding: 8px;
    cursor: pointer;
  }
  .country-list div:hover {
    background: #f0f0f0;
  }
</style>
</head>
<body>
<div class="form-box">
  <h2 id="formTitle">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>

  <div class="lang-buttons">
    <button type="button" class="lang-btn active" data-lang="ru">RU</button>
    <button type="button" class="lang-btn" data-lang="ro">RO</button>
    <button type="button" class="lang-btn" data-lang="en">EN</button>
  </div>

  <form id="form">
    <label id="countryLabel">–°—Ç—Ä–∞–Ω–∞</label>
    <input type="search" id="countryInput" placeholder="–ü–æ–∏—Å–∫ —Å—Ç—Ä–∞–Ω—ã..." autocomplete="off">
    <div id="countryList" class="country-list"></div>

    <label id="phoneLabel">–¢–µ–ª–µ—Ñ–æ–Ω</label>
    <div class="phone-wrapper">
      <div class="flag" id="flag">üá≤üá©</div>
      <input type="tel" name="phone" class="phone-input" id="phoneInput" placeholder="+373" required>
    </div>

    <label id="nameLabel">–§–ò–û</label>
    <input type="text" name="fullName" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –§–ò–û">

    <label id="emailLabel">Email</label>
    <input type="email" name="email" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Email">

    <label id="birthLabel">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
    <input type="date" name="birthDate" required>

    <label id="roleLabel">–¢–∏–ø —É—á–∞—Å—Ç–Ω–∏–∫–∞</label>
    <select id="role" name="role" required>
      <option value="">--–≤—ã–±–µ—Ä–∏—Ç–µ--</option>
      <option value="consultant">–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</option>
      <option value="client">–ö–ª–∏–µ–Ω—Ç</option>
    </select>

    <div id="consultantsBlock" class="hidden">
      <label id="consultantLabel">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞</label>
      <select id="consultantSelect" name="consultant" required>
        <option value="">--–≤—ã–±–µ—Ä–∏—Ç–µ--</option>
      </select>
    </div>

    <div class="checkbox-row">
      <input type="checkbox" id="consent" required>
      <label for="consent" id="consentLabel">–Ø —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
    </div>

    <input type="hidden" name="country" id="countryHidden">
    <input type="hidden" name="chat_id" id="chat_id">

    <button type="submit" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="msg" class="msg"></div>
  </form>
</div>

<script>
const countries = [
  { name: "–ú–æ–ª–¥–æ–≤–∞", code: "+373", flag: "üá≤üá©" },
  { name: "–†–æ—Å—Å–∏—è", code: "+7", flag: "üá∑üá∫" },
  { name: "–†—É–º—ã–Ω–∏—è", code: "+40", flag: "üá∑üá¥" },
  { name: "–£–∫—Ä–∞–∏–Ω–∞", code: "+380", flag: "üá∫üá¶" },
  { name: "–°–®–ê", code: "+1", flag: "üá∫üá∏" },
  { name: "–ì–µ—Ä–º–∞–Ω–∏—è", code: "+49", flag: "üá©üá™" },
];

const countryInput = document.getElementById('countryInput');
const countryList = document.getElementById('countryList');
const countryHidden = document.getElementById('countryHidden');
const flagDiv = document.getElementById('flag');
const phoneInput = document.getElementById('phoneInput');

// –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞–Ω
countryInput.addEventListener('input', () => {
  const query = countryInput.value.toLowerCase();
  countryList.innerHTML = '';
  if (query.length > 0) {
    const filtered = countries.filter(c => c.name.toLowerCase().includes(query) || c.name.toLowerCase().includes(query));
    filtered.forEach(c => {
      const div = document.createElement('div');
      div.textContent = `${c.flag} ${c.name} (${c.code})`;
      div.addEventListener('click', () => {
        countryInput.value = c.name;
        countryHidden.value = c.name;
        phoneInput.value = c.code;
        flagDiv.textContent = c.flag;
        countryList.style.display = 'none';
      });
      countryList.appendChild(div);
    });
    countryList.style.display = filtered.length ? 'block' : 'none';
  } else {
    countryList.style.display = 'none';
  }
});

// Chat_id –∏–∑ —Å—Ç—Ä–æ–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
document.getElementById('chat_id').value = new URLSearchParams(window.location.search).get('chat_id') || '';

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –∏–∑ Google Sheets
const consultantSelect = document.getElementById('consultantSelect');
fetch("https://opensheet.elk.sh/<–í–ê–®_ID_–¢–ê–ë–õ–ò–¶–´>/Consultant")
  .then(r => r.json())
  .then(rows => {
    rows.forEach(row => {
      const opt = document.createElement('option');
      opt.value = row.ID || row.Name;
      opt.textContent = row.Name;
      consultantSelect.appendChild(opt);
    });
  });

// –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –±–ª–æ–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤
document.getElementById('role').addEventListener('change', (e) => {
  document.getElementById('consultantsBlock').classList.toggle('hidden', e.target.value !== 'client');
});

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
const form = document.getElementById('form');
const msg = document.getElementById('msg');
form.addEventListener('submit', async e => {
  e.preventDefault();
  msg.textContent = '';
  msg.className = 'msg';
  
  if (!document.getElementById('consent').checked) {
    msg.textContent = '–í—ã –¥–æ–ª–∂–Ω—ã —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö!';
    msg.classList.add('error');
    return;
  }

  const data = {
    fullName: form.fullName.value.trim(),
    phone: phoneInput.value.trim(),
    email: form.email.value.trim(),
    birthDate: form.birthDate.value,
    role: document.getElementById('role').value,
    consultant: consultantSelect.value || null,
    country: countryHidden.value,
    chat_id: document.getElementById('chat_id').value
  };

  try {
    const res = await fetch('https://hook.eu2.make.com/9h9m39efm8lp2sen3fm6y6rm74rrc73n', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    if (res.ok) {
      msg.textContent = '‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!';
      msg.classList.add('success');
      form.reset();
    } else {
      msg.textContent = `‚ùå –û—à–∏–±–∫–∞ ${res.status}`;
      msg.classList.add('error');
    }
  } catch (err) {
    msg.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏';
    msg.classList.add('error');
  }
});
</script>
</body>
</html>
