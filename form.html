<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Beauty Expert</title>
<style>
  :root {
    --accent:#6A0DAD;
    --accent-dark:#4B0277;
    --bg:#FAF9F7;
    --input:#F0EDED;
    --text:#333;
  }
  body {
    font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    background:var(--bg);
    display:flex;justify-content:center;align-items:center;
    height:100vh;margin:0;
  }
  .form-box {
    background:#fff;border-radius:12px;
    padding:30px 40px;box-shadow:0 4px 12px rgba(0,0,0,.1);
    width:100%;max-width:420px;
  }
  h2{text-align:center;color:var(--accent);margin-bottom:20px;}
  .lang-switch {
    display:flex;justify-content:space-between;margin-bottom:15px;
  }
  .lang-switch button {
    flex:1;margin:0 2px;padding:8px 0;border:none;border-radius:6px;
    background:#e0e0e0;font-weight:bold;cursor:pointer;transition:.2s;
  }
  .lang-switch button.active {background:var(--accent);color:#fff;}
  label{display:block;margin-bottom:6px;font-weight:500;color:var(--text);}
  input,select {
    width:100%;padding:10px 12px;margin-bottom:12px;
    border:1px solid #ccc;border-radius:8px;
    font-size:15px;box-sizing:border-box;background:var(--input);
  }
  input:focus,select:focus {
    outline:none;border-color:var(--accent);
    box-shadow:0 0 4px rgba(106,13,173,.3);
  }
  .phone-field {display:flex;align-items:center;margin-bottom:12px;}
  .flag-btn {
    width:44px;height:44px;display:flex;align-items:center;justify-content:center;
    background:#fff;border:1px solid #ccc;border-radius:8px 0 0 8px;
    cursor:pointer;font-size:20px;
  }
  #phoneInput {border-radius:0 8px 8px 0;margin:0;}
  .country-list {
    position:absolute;background:#fff;border:1px solid #ccc;border-radius:6px;
    max-height:200px;overflow-y:auto;z-index:1000;width:150px;display:none;
  }
  .country-list div {padding:6px 10px;cursor:pointer;}
  .country-list div:hover {background:#f0f0f0;}
  .consent {display:flex;align-items:center;margin:10px 0;}
  .consent input {margin-right:8px;}
  button[type="submit"] {
    width:100%;padding:12px 0;margin-top:10px;
    background:var(--accent);color:#fff;border:none;border-radius:8px;
    font-size:16px;cursor:pointer;font-weight:bold;transition:.2s;
  }
  button[type="submit"]:hover {background:var(--accent-dark);}
  .msg{text-align:center;margin-top:10px;font-weight:bold;}
  .msg.success{color:green;} .msg.error{color:darkred;}
</style>
</head>
<body>
<div class="form-box">
  <h2 id="formTitle">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Beauty Expert</h2>

  <!-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ -->
  <div class="lang-switch">
    <button type="button" data-lang="ru" class="active">RU</button>
    <button type="button" data-lang="ro">RO</button>
    <button type="button" data-lang="en">EN</button>
  </div>

  <form id="form">
    <label id="fullNameLabel">–§–ò–û</label>
    <input type="text" id="fullNameInput" name="fullName" required placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">

    <label id="phoneLabel">–¢–µ–ª–µ—Ñ–æ–Ω</label>
    <div class="phone-field">
      <div class="flag-btn" id="flagBtn">üá≤üá©</div>
      <input type="tel" id="phoneInput" name="phone" required placeholder="+373 123 456">
      <div id="countryDropdown" class="country-list"></div>
    </div>

    <label id="emailLabel">Email</label>
    <input type="email" id="emailInput" name="email" required placeholder="mail@example.com">

    <label id="birthLabel">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
    <input type="date" id="birthDate" name="birthDate" required>

    <label id="roleLabel">–¢–∏–ø —É—á–∞—Å—Ç–Ω–∏–∫–∞</label>
    <select id="role" name="role" required>
      <option value="">--–≤—ã–±–µ—Ä–∏—Ç–µ--</option>
      <option value="consultant">–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</option>
      <option value="client">–ö–ª–∏–µ–Ω—Ç</option>
    </select>

    <div id="consultantsBlock" style="display:none;">
      <label id="consultantLabel">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞</label>
      <select id="consultantSelect" name="consultant">
        <option value="">--–≤—ã–±–µ—Ä–∏—Ç–µ--</option>
      </select>
    </div>

    <div class="consent">
      <input type="checkbox" id="consentCheck">
      <label id="consentLabel" for="consentCheck">–Ø —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
    </div>

    <input type="hidden" name="timezone" id="timezoneHidden">
    <input type="hidden" name="chat_id" id="chat_id">

    <button type="submit" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="msg" class="msg"></div>
  </form>
</div>

<script>
const countries = [
  {flag:"üá≤üá©", name:"Moldova", code:"+373"},
  {flag:"üá∑üá∫", name:"Russia", code:"+7"},
  {flag:"üá∑üá¥", name:"Romania", code:"+40"},
  {flag:"üá∫üá¶", name:"Ukraine", code:"+380"},
  {flag:"üá∫üá∏", name:"USA", code:"+1"},
  {flag:"üá¨üáß", name:"UK", code:"+44"}
];

const translations = {
  ru:{
    title:"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Beauty Expert",
    fullName:"–§–ò–û", phone:"–¢–µ–ª–µ—Ñ–æ–Ω", email:"Email", birth:"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è",
    role:"–¢–∏–ø —É—á–∞—Å—Ç–Ω–∏–∫–∞", consultant:"–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞",
    consent:"–Ø —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö",
    submit:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å", error:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ."
  },
  ro:{
    title:"√énregistrare Beauty Expert",
    fullName:"Nume complet", phone:"Telefon", email:"Email", birth:"Data na»ôterii",
    role:"Tip participant", consultant:"Alege»õi consultantul",
    consent:"Sunt de acord cu prelucrarea datelor personale",
    submit:"Trimite", error:"Completa»õi toate c√¢mpurile »ôi bifa»õi consim»õƒÉm√¢ntul."
  },
  en:{
    title:"Beauty Expert Registration",
    fullName:"Full Name", phone:"Phone", email:"Email", birth:"Date of Birth",
    role:"Participant Type", consultant:"Select Consultant",
    consent:"I agree to the processing of personal data",
    submit:"Submit", error:"Please fill all fields and confirm consent."
  }
};

const flagBtn=document.getElementById('flagBtn');
const dropdown=document.getElementById('countryDropdown');
const phoneInput=document.getElementById('phoneInput');

function renderCountries(){
  dropdown.innerHTML='';
  countries.forEach(c=>{
    const div=document.createElement('div');
    div.textContent=`${c.flag} ${c.name} (${c.code})`;
    div.onclick=()=>{
      flagBtn.textContent=c.flag;
      phoneInput.value=c.code+' ';
      dropdown.style.display='none';
    };
    dropdown.appendChild(div);
  });
}
flagBtn.onclick=()=>{
  dropdown.style.display=dropdown.style.display==='block'?'none':'block';
};
document.addEventListener('click',e=>{
  if(!flagBtn.contains(e.target) && !dropdown.contains(e.target)){
    dropdown.style.display='none';
  }
});
renderCountries();

/* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ */
const langButtons=document.querySelectorAll('.lang-switch button');
langButtons.forEach(btn=>{
  btn.addEventListener('click',()=>{
    langButtons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    setLang(btn.dataset.lang);
  });
});
function setLang(lang){
  const t=translations[lang];
  document.getElementById('formTitle').textContent=t.title;
  document.getElementById('fullNameLabel').textContent=t.fullName;
  document.getElementById('phoneLabel').textContent=t.phone;
  document.getElementById('emailLabel').textContent=t.email;
  document.getElementById('birthLabel').textContent=t.birth;
  document.getElementById('roleLabel').textContent=t.role;
  document.getElementById('consultantLabel').textContent=t.consultant;
  document.getElementById('consentLabel').textContent=t.consent;
  document.getElementById('submitBtn').textContent=t.submit;
}

/* –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å */
document.getElementById('timezoneHidden').value=Intl.DateTimeFormat().resolvedOptions().timeZone||'UTC';
document.getElementById('chat_id').value=new URLSearchParams(window.location.search).get('chat_id')||''; 

/* –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –∏–∑ Google Sheets */
async function loadConsultants(){
  try{
    const url="https://opensheet.elk.sh/10CzQHC01UjusQsFYobQ6a54zV0z__XAkxva_Ir3vDVw/Consultant";
    const res=await fetch(url);
    const data=await res.json();
    const sel=document.getElementById('consultantSelect');
    data.forEach(row=>{
      const opt=document.createElement('option');
      opt.value=row.ID||row.id||row.Name;
      opt.textContent=row.Name;
      sel.appendChild(opt);
    });
  }catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤",e);}
}
loadConsultants();

/* –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –±–ª–æ–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ */
const roleSel=document.getElementById('role');
roleSel.addEventListener('change',()=>{
  document.getElementById('consultantsBlock').style.display=roleSel.value==='client'?'block':'none';
});

/* –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã */
const form=document.getElementById('form');
const msg=document.getElementById('msg');
form.addEventListener('submit',async e=>{
  e.preventDefault();
  msg.textContent='';
  if(!document.getElementById('consentCheck').checked){
    msg.textContent=translations.ru.error;
    msg.className='msg error';
    return;
  }
  const data={
    fullName:form.fullName.value.trim(),
    phone:phoneInput.value.trim(),
    email:form.email.value.trim(),
    birthDate:form.birthDate.value,
    role:roleSel.value,
    consultant:document.getElementById('consultantSelect').value||null,
    timezone:document.getElementById('timezoneHidden').value,
    chat_id:document.getElementById('chat_id').value
  };
  try{
    const res=await fetch('https://hook.eu2.make.com/9h9m39efm8lp2sen3fm6y6rm74rrc73n',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    if(res.ok){
      msg.textContent='‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!';
      msg.className='msg success';
      form.reset();
    }else{
      msg.textContent='‚ùå –û—à–∏–±–∫–∞ '+res.status;
      msg.className='msg error';
    }
  }catch(err){
    msg.textContent='‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞';
    msg.className='msg error';
  }
});
</script>
</body>
</html>
